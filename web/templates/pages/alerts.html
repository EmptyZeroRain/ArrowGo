{{ template "base" . }}

{{ define "content" }}
    <div class="alerts-section">
        <h2>告警通道管理</h2>
        <button class="btn btn-primary" onclick="showAlertChannelModal()">
            <i class="fas fa-plus"></i> 添加告警通道
        </button>

        <div class="table-container" style="margin-top: 20px;">
            <table class="monitors-table">
                <thead>
                    <tr>
                        <th>名称</th>
                        <th>类型</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="alert-channels-tbody">
                    <tr>
                        <td colspan="4" class="loading">加载中...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="alerts-section" style="margin-top: 40px;">
        <h2>告警规则管理</h2>
        <button class="btn btn-primary" onclick="showAlertRuleModal()">
            <i class="fas fa-plus"></i> 添加告警规则
        </button>

        <div class="table-container" style="margin-top: 20px;">
            <table class="monitors-table">
                <thead>
                    <tr>
                        <th>监控目标</th>
                        <th>告警通道</th>
                        <th>阈值类型</th>
                        <th>阈值</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="alert-rules-tbody">
                    <tr>
                        <td colspan="6" class="loading">加载中...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
{{ end }}

{{ define "modals" }}
    <!-- Alert Channel Modal -->
    <div id="alert-channel-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="alert-channel-modal-title">添加告警通道</h2>
                <button class="close-btn" onclick="closeAlertChannelModal()">&times;</button>
            </div>
            <form id="alert-channel-form" onsubmit="submitAlertChannel(event)">
                <input type="hidden" id="alert-channel-id">

                <div class="form-section">
                    <h3>通道信息</h3>
                    <div class="form-group">
                        <label for="alert-channel-name">名称 *</label>
                        <input type="text" id="alert-channel-name" required placeholder="例如: 运维告警群">
                        <small>为告警通道设置一个友好的名称</small>
                    </div>
                    <div class="form-group">
                        <label for="alert-channel-type">通道类型 *</label>
                        <select id="alert-channel-type" required onchange="updateAlertChannelFields()">
                            <option value="wechat">企业微信</option>
                            <option value="dingtalk">钉钉</option>
                            <option value="telegram">Telegram</option>
                            <option value="email">邮件</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="alert-channel-enabled" checked>
                            启用通道
                        </label>
                    </div>
                </div>

                <!-- WeChat Settings -->
                <div class="form-section" id="alert-wechat-section" style="display: none;">
                    <h3>企业微信配置</h3>
                    <div class="form-group">
                        <label for="wechat-webhook">Webhook URL *</label>
                        <input type="text" id="wechat-webhook" placeholder="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY">
                        <small>企业微信机器人的Webhook地址</small>
                    </div>
                </div>

                <!-- DingTalk Settings -->
                <div class="form-section" id="alert-dingtalk-section" style="display: none;">
                    <h3>钉钉配置</h3>
                    <div class="form-group">
                        <label for="dingtalk-webhook">Webhook URL *</label>
                        <input type="text" id="dingtalk-webhook" placeholder="https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN">
                        <small>钉钉机器人的Webhook地址</small>
                    </div>
                    <div class="form-group">
                        <label for="dingtalk-secret">加签密钥（可选）</label>
                        <input type="text" id="dingtalk-secret" placeholder="SECxxx">
                        <small>钉钉机器人的加签密钥</small>
                    </div>
                </div>

                <!-- Telegram Settings -->
                <div class="form-section" id="alert-telegram-section" style="display: none;">
                    <h3>Telegram配置</h3>
                    <div class="form-group">
                        <label for="telegram-bot-token">Bot Token *</label>
                        <input type="text" id="telegram-bot-token" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                        <small>Telegram Bot的Token</small>
                    </div>
                    <div class="form-group">
                        <label for="telegram-chat-id">Chat ID *</label>
                        <input type="text" id="telegram-chat-id" placeholder="-1001234567890">
                        <small>接收消息的Chat ID（可以是群组或个人）</small>
                    </div>
                </div>

                <!-- Email Settings -->
                <div class="form-section" id="alert-email-section" style="display: none;">
                    <h3>邮件配置</h3>
                    <div class="form-group">
                        <label for="email-smtp-host">SMTP服务器 *</label>
                        <input type="text" id="email-smtp-host" placeholder="smtp.gmail.com">
                    </div>
                    <div class="form-group">
                        <label for="email-smtp-port">SMTP端口 *</label>
                        <input type="number" id="email-smtp-port" placeholder="587" value="587">
                    </div>
                    <div class="form-group">
                        <label for="email-username">用户名 *</label>
                        <input type="text" id="email-username" placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="email-password">密码 *</label>
                        <input type="password" id="email-password" placeholder="your-password">
                        <small>通常是应用专用密码</small>
                    </div>
                    <div class="form-group">
                        <label for="email-from">发件人地址 *</label>
                        <input type="email" id="email-from" placeholder="monitor@example.com">
                    </div>
                    <div class="form-group">
                        <label for="email-to">收件人地址 *</label>
                        <input type="text" id="email-to" placeholder="admin@example.com, ops@example.com">
                        <small>多个地址用逗号分隔</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="email-use-tls" checked>
                            使用TLS
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAlertChannelModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert Rule Modal -->
    <div id="alert-rule-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="alert-rule-modal-title">添加告警规则</h2>
                <button class="close-btn" onclick="closeAlertRuleModal()">&times;</button>
            </div>
            <form id="alert-rule-form" onsubmit="submitAlertRule(event)">
                <input type="hidden" id="alert-rule-id">

                <div class="form-section">
                    <h3>告警规则</h3>
                    <div class="form-group">
                        <label for="alert-rule-target">监控目标 *</label>
                        <select id="alert-rule-target" required>
                            <option value="">请选择监控目标</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alert-rule-channel">告警通道 *</label>
                        <select id="alert-rule-channel" required>
                            <option value="">请选择告警通道</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alert-rule-threshold-type">阈值类型 *</label>
                        <select id="alert-rule-threshold-type" required>
                            <option value="failure_count">故障次数</option>
                            <option value="response_time">响应时间</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alert-rule-threshold-value">阈值 *</label>
                        <input type="number" id="alert-rule-threshold-value" required min="1" value="1">
                        <small>触发告警的阈值（次数或毫秒数）</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="alert-rule-enabled" checked>
                            启用规则
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAlertRuleModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
{{ end }}

{{ define "scripts" }}
    <script src="/static/js/alerts.js"></script>
{{ end }}
