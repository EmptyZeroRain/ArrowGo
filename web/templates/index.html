<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>Monitor Dashboard</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="showAddModal()">
                    <i class="fas fa-plus"></i> 添加监控
                </button>
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> 刷新
                </button>
            </div>
        </header>

        <!-- Tabs Navigation -->
        <div class="tabs-nav">
            <button class="tab-btn active" onclick="switchTab('monitors')">
                <i class="fas fa-list"></i> 监控列表
            </button>
            <button class="tab-btn" onclick="switchTab('ipgeo')">
                <i class="fas fa-globe"></i> IP 查询
            </button>
            <button class="tab-btn" onclick="switchTab('logs')">
                <i class="fas fa-file-alt"></i> 日志查询
            </button>
            <button class="tab-btn" onclick="switchTab('alerts')">
                <i class="fas fa-bell"></i> 告警管理
            </button>
            <button class="tab-btn" onclick="switchTab('settings')">
                <i class="fas fa-cog"></i> 系统设置
            </button>
        </div>

        <!-- Tab Contents -->
        <div class="main-content">
            <!-- Monitors Tab -->
            <div id="tab-monitors" class="tab-content active">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon up">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-up">0</h3>
                            <p>在线监控</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon down">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-down">0</h3>
                            <p>离线监控</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-total">0</h3>
                            <p>总监控数</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon avg">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="stat-avg">0ms</h3>
                            <p>平均响应时间</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>监控列表</h2>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>名称</th>
                                    <th>类型</th>
                                    <th>地址</th>
                                    <th>状态</th>
                                    <th>响应时间</th>
                                    <th>正常运行时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="monitors-tbody">
                                <tr>
                                    <td colspan="7" class="loading">加载中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- IP Geo Tab -->
            <div id="tab-ipgeo" class="tab-content">
                <div class="section">
                    <h2>IP 地理位置查询</h2>
                    <div class="form-group">
                        <div style="display: flex; gap: var(--spacing-3);">
                            <input type="text" id="ip-input" placeholder="输入 IP 地址 (例如: 8.8.8.8)" style="flex: 1;">
                            <button class="btn btn-primary" onclick="queryIPGeo()">
                                <i class="fas fa-search"></i> 查询
                            </button>
                        </div>
                    </div>
                    <div id="ipgeo-result" style="display: none;">
                        <div style="background: var(--color-gray-50); border-radius: var(--radius-lg); padding: var(--spacing-5);">
                            <div id="geo-info" style="display: flex; flex-direction: column; gap: var(--spacing-3);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div id="tab-logs" class="tab-content">
                <div class="section">
                    <h2>日志查询 <small style="font-size: 14px; color: #6b7280; font-weight: normal;">(需要启用 Elasticsearch)</small></h2>

                    <div class="log-search-form">
                        <div class="form-group">
                            <label for="log-target">监控目标</label>
                            <select id="log-target">
                                <option value="">全部目标</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="log-status">状态</label>
                            <select id="log-status">
                                <option value="">全部</option>
                                <option value="up">在线</option>
                                <option value="down">离线</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="log-query">关键词搜索</label>
                            <input type="text" id="log-query" placeholder="搜索请求/响应内容">
                        </div>

                        <div class="form-group">
                            <label for="log-size">每页数量</label>
                            <select id="log-size">
                                <option value="10">10 条</option>
                                <option value="20" selected>20 条</option>
                                <option value="50">50 条</option>
                                <option value="100">100 条</option>
                            </select>
                        </div>

                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="searchLogs()" style="width: 100%;">
                                <i class="fas fa-search"></i> 搜索
                            </button>
                        </div>
                    </div>

                    <div id="log-results" class="log-results">
                        <div style="text-align: center; padding: 40px; color: #6b7280;">
                            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 10px;"></i>
                            <p>输入搜索条件并点击搜索按钮</p>
                        </div>
                    </div>

                    <div id="log-pagination" style="display: none; margin-top: 20px; text-align: center;">
                        <button class="btn btn-secondary" onclick="loadLogs('prev')">
                            <i class="fas fa-chevron-left"></i> 上一页
                        </button>
                        <span id="log-page-info" style="margin: 0 15px;"></span>
                        <button class="btn btn-secondary" onclick="loadLogs('next')">
                            下一页 <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="tab-alerts" class="tab-content">
                <div class="section">
                    <h2>
                        告警通道管理
                        <button class="btn btn-primary" onclick="showAlertChannelModal()">
                            <i class="fas fa-plus"></i> 添加告警通道
                        </button>
                    </h2>

                    <div class="table-container" style="margin-top: var(--spacing-5);">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>名称</th>
                                    <th>类型</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="alert-channels-tbody">
                                <tr>
                                    <td colspan="4" class="loading">加载中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="section" style="margin-top: var(--spacing-8);">
                    <h2>
                        告警规则管理
                        <button class="btn btn-primary" onclick="showAlertRuleModal()">
                            <i class="fas fa-plus"></i> 添加告警规则
                        </button>
                    </h2>

                    <div class="table-container" style="margin-top: var(--spacing-5);">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>监控目标</th>
                                    <th>告警通道</th>
                                    <th>阈值类型</th>
                                    <th>阈值</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="alert-rules-tbody">
                                <tr>
                                    <td colspan="6" class="loading">加载中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="tab-settings" class="tab-content">
                <div class="section">
                    <h2>
                        系统配置
                        <div style="display: flex; gap: var(--spacing-3);">
                            <button class="btn btn-primary" onclick="loadSystemConfig()">
                                <i class="fas fa-sync-alt"></i> 刷新配置
                            </button>
                            <button class="btn btn-success" onclick="showSystemConfigModal()">
                                <i class="fas fa-edit"></i> 编辑配置
                            </button>
                        </div>
                    </h2>

                    <div id="config-display" class="config-display">
                        <div class="config-placeholder">
                            <i class="fas fa-cog"></i>
                            <p>点击"刷新配置"按钮查看当前系统配置</p>
                        </div>
                    </div>
                </div>

                <div class="section" style="margin-top: var(--spacing-8);">
                    <h2>
                        DNS 供应商管理
                        <button class="btn btn-primary" onclick="showDNSProviderModal()">
                            <i class="fas fa-plus"></i> 添加DNS供应商
                        </button>
                    </h2>

                    <div class="table-container" style="margin-top: var(--spacing-5);">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>名称</th>
                                    <th>服务器地址</th>
                                    <th>协议类型</th>
                                    <th>默认</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="dns-providers-tbody">
                                <tr>
                                    <td colspan="5" class="loading">加载中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="monitor-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">添加监控</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="monitor-form" onsubmit="submitMonitor(event)">
                <input type="hidden" id="monitor-id">

                <!-- Basic Settings -->
                <div class="form-section">
                    <h3>基本设置</h3>
                    <div class="form-group">
                        <label for="monitor-name">名称 *</label>
                        <input type="text" id="monitor-name" required>
                    </div>
                    <div class="form-group">
                        <label for="monitor-type">类型 *</label>
                        <select id="monitor-type" required onchange="updateFormFields()">
                            <option value="http">HTTP</option>
                            <option value="https">HTTPS</option>
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                            <option value="dns">DNS</option>
                            <option value="ping">PING</option>
                            <option value="smtp">SMTP</option>
                            <option value="snmp">SNMP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="monitor-address">地址 *</label>
                        <input type="text" id="monitor-address" required placeholder="例如: www.google.com 或 https://api.example.com:8443/v1/status">
                        <small>支持完整URL（包含路径），将自动识别协议、端口和域名</small>
                    </div>
                    <div class="form-group" id="port-group">
                        <label for="monitor-port">端口</label>
                        <input type="number" id="monitor-port" placeholder="例如: 443">
                    </div>
                    <div class="form-group">
                        <label for="monitor-interval">检查间隔 (秒)</label>
                        <input type="number" id="monitor-interval" value="60" min="10">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="monitor-enabled" checked>
                            启用监控
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="monitor-alert-channels">关联告警通道</label>
                        <select id="monitor-alert-channels" multiple size="4" style="height: auto;">
                            <option value="">加载中...</option>
                        </select>
                        <small>按住 Ctrl/Cmd 键可多选告警通道</small>
                    </div>
                </div>

                <!-- HTTP/HTTPS Settings -->
                <div class="form-section" id="http-section" style="display: none;">
                    <h3>HTTP/HTTPS 设置</h3>
                    <div class="form-group">
                        <label for="monitor-http-method">HTTP 方法</label>
                        <select id="monitor-http-method">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="PATCH">PATCH</option>
                            <option value="HEAD">HEAD</option>
                            <option value="OPTIONS">OPTIONS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="monitor-http-body">请求体 (JSON)</label>
                        <textarea id="monitor-http-body" rows="4" placeholder='{"key": "value"}'></textarea>
                    </div>
                    <div class="form-group">
                        <label for="monitor-resolved-host">自定义 Host 头 / IP绑定</label>
                        <input type="text" id="monitor-resolved-host" placeholder="例如: example.com 或 192.168.1.1">
                        <small>指定域名(用于Host头)或IP地址(用于域名解析绑定)</small>
                    </div>

                    <!-- SSL/TLS Certificate Monitoring (for HTTPS only) -->
                    <div id="ssl-options" style="display: none; border-top: 2px solid var(--color-gray-200); padding-top: var(--spacing-4); margin-top: var(--spacing-4);">
                        <h4 style="margin: 0 0 var(--spacing-4) 0; color: var(--color-primary-600);">
                            <i class="fas fa-lock"></i> SSL/TLS 证书监控
                        </h4>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="monitor-ssl-check" onchange="toggleSSLOptions()">
                                启用SSL/TLS证书监控
                            </label>
                            <small>监控HTTPS证书并获取证书链信息</small>
                        </div>
                        <div id="ssl-config" style="display: none;">
                            <div class="form-group">
                                <label for="monitor-ssl-warn-days">警告阈值 (天)</label>
                                <input type="number" id="monitor-ssl-warn-days" value="30" min="1" max="365">
                                <small>证书过期前多少天开始警告</small>
                            </div>
                            <div class="form-group">
                                <label for="monitor-ssl-critical-days">严重阈值 (天)</label>
                                <input type="number" id="monitor-ssl-critical-days" value="7" min="1" max="365">
                                <small>证书过期前多少天标记为严重</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="monitor-ssl-get-chain" checked>
                                    获取证书链信息
                                </label>
                                <small>获取并显示完整的证书链（包括中间证书和根证书）</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- HTTP Headers -->
                <div class="form-section" id="headers-section" style="display: none;">
                    <h3>HTTP 请求头</h3>
                    <div id="headers-container">
                        <!-- Headers will be added dynamically -->
                    </div>
                    <button type="button" class="btn btn-sm btn-secondary" onclick="addHeaderRow()">
                        <i class="fas fa-plus"></i> 添加请求头
                    </button>
                </div>

                <!-- DNS Settings -->
                <div class="form-section" id="dns-section" style="display: none;">
                    <h3>DNS 设置</h3>
                    <div class="form-group">
                        <label for="monitor-dns-provider">DNS 供应商</label>
                        <select id="monitor-dns-provider" onchange="selectDNSProvider()">
                            <option value="">手动输入</option>
                        </select>
                        <small>从预设的DNS供应商中选择，或选择"手动输入"自定义</small>
                    </div>
                    <div class="form-group">
                        <label for="monitor-dns-server-name">DNS 服务器名称</label>
                        <input type="text" id="monitor-dns-server-name" placeholder="例如: 谷歌DNS">
                        <small>为DNS服务器设置一个友好的名称（可选）</small>
                    </div>
                    <div class="form-group">
                        <label for="monitor-dns-server">DNS 服务器地址</label>
                        <input type="text" id="monitor-dns-server" placeholder="例如: 8.8.8.8:53 或 https://dns.google/resolve">
                        <small>DNS服务器地址和端口（可选）</small>
                    </div>
                    <div class="form-group">
                        <label for="monitor-dns-server-type">DNS 协议类型</label>
                        <select id="monitor-dns-server-type">
                            <option value="udp">UDP (传统DNS)</option>
                            <option value="tcp">TCP (DNS over TCP)</option>
                            <option value="doh">DoH (DNS over HTTPS)</option>
                            <option value="dot">DoT (DNS over TLS)</option>
                        </select>
                        <small>选择DNS查询协议类型</small>
                    </div>
                </div>

                <!-- SNMP Settings -->
                <div class="form-section" id="snmp-section" style="display: none;">
                    <h3>SNMP 设置</h3>
                    <div class="form-group">
                        <label for="monitor-snmp-community">Community 字符串</label>
                        <input type="text" id="monitor-snmp-community" placeholder="public">
                        <small>SNMP community 字符串（默认: public）</small>
                    </div>
                    <div class="form-group">
                        <label for="monitor-snmp-oid">OID</label>
                        <input type="text" id="monitor-snmp-oid" placeholder="1.3.6.1.2.1.1.1.0">
                        <small>要查询的 SNMP OID（默认: sysDescr.0）</small>
                    </div>
                    <div class="form-group">
                        <label for="monitor-snmp-version">SNMP 版本</label>
                        <select id="monitor-snmp-version">
                            <option value="v2c">v2c</option>
                            <option value="v1">v1</option>
                            <option value="v3">v3</option>
                        </select>
                        <small>选择 SNMP 版本</small>
                    </div>
                    <div class="form-group">
                        <label for="monitor-snmp-operator">比较运算符</label>
                        <select id="monitor-snmp-operator">
                            <option value="">无（仅查询）</option>
                            <option value="eq">等于 (eq)</option>
                            <option value="ne">不等于 (ne)</option>
                            <option value="gt">大于 (gt)</option>
                            <option value="lt">小于 (lt)</option>
                            <option value="ge">大于等于 (ge)</option>
                            <option value="le">小于等于 (le)</option>
                        </select>
                        <small>选择用于值比较的运算符（可选）</small>
                    </div>
                    <div class="form-group">
                        <label for="monitor-snmp-expected-value">期望值</label>
                        <input type="text" id="monitor-snmp-expected-value" placeholder="期望的值">
                        <small>用于与实际值比较的期望值（当选择了运算符时）</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Log Detail Modal -->
    <div id="log-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>日志详情</h2>
                <button class="close-btn" onclick="closeLogModal()">&times;</button>
            </div>
            <div id="log-modal-content"></div>
        </div>
    </div>

    <!-- Monitor Details Modal -->
    <div id="monitor-details-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>监控详情</h2>
                <button class="close-btn" onclick="closeMonitorDetailsModal()">&times;</button>
            </div>
            <div id="monitor-details-content"></div>
        </div>
    </div>

    <!-- Check Log Detail Modal -->
    <div id="check-log-detail-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>拨测日志详情</h2>
                <button class="close-btn" onclick="closeCheckLogDetailModal()">&times;</button>
            </div>
            <div id="check-log-detail-content"></div>
        </div>
    </div>

    <!-- DNS Provider Modal -->
    <div id="dns-provider-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="dns-provider-modal-title">添加DNS供应商</h2>
                <button class="close-btn" onclick="closeDNSProviderModal()">&times;</button>
            </div>
            <form id="dns-provider-form" onsubmit="submitDNSProvider(event)">
                <input type="hidden" id="dns-provider-id">

                <div class="form-section">
                    <h3>DNS供应商信息</h3>
                    <div class="form-group">
                        <label for="dns-provider-name">名称 *</label>
                        <input type="text" id="dns-provider-name" required placeholder="例如: 谷歌DNS">
                        <small>为DNS供应商设置一个友好的名称</small>
                    </div>
                    <div class="form-group">
                        <label for="dns-provider-server">服务器地址 *</label>
                        <input type="text" id="dns-provider-server" required placeholder="例如: 8.8.8.8:53 或 https://dns.google/resolve">
                        <small>DNS服务器地址和端口</small>
                    </div>
                    <div class="form-group">
                        <label for="dns-provider-type">协议类型 *</label>
                        <select id="dns-provider-type" required>
                            <option value="udp">UDP (传统DNS)</option>
                            <option value="tcp">TCP (DNS over TCP)</option>
                            <option value="doh">DoH (DNS over HTTPS)</option>
                            <option value="dot">DoT (DNS over TLS)</option>
                        </select>
                        <small>选择DNS查询协议类型</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="dns-provider-default">
                            设为默认供应商
                        </label>
                        <small>标记为默认DNS供应商</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDNSProviderModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert Channel Modal -->
    <div id="alert-channel-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="alert-channel-modal-title">添加告警通道</h2>
                <button class="close-btn" onclick="closeAlertChannelModal()">&times;</button>
            </div>
            <form id="alert-channel-form" onsubmit="submitAlertChannel(event)">
                <input type="hidden" id="alert-channel-id">

                <div class="form-section">
                    <h3>通道信息</h3>
                    <div class="form-group">
                        <label for="alert-channel-name">名称 *</label>
                        <input type="text" id="alert-channel-name" required placeholder="例如: 运维告警群">
                        <small>为告警通道设置一个友好的名称</small>
                    </div>
                    <div class="form-group">
                        <label for="alert-channel-type">通道类型 *</label>
                        <select id="alert-channel-type" required onchange="updateAlertChannelFields()">
                            <option value="wechat">企业微信</option>
                            <option value="dingtalk">钉钉</option>
                            <option value="telegram">Telegram</option>
                            <option value="email">邮件</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="alert-channel-enabled" checked>
                            启用通道
                        </label>
                    </div>
                </div>

                <!-- WeChat Settings -->
                <div class="form-section" id="alert-wechat-section" style="display: none;">
                    <h3>企业微信配置</h3>
                    <div class="form-group">
                        <label for="wechat-webhook">Webhook URL *</label>
                        <input type="text" id="wechat-webhook" placeholder="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY">
                        <small>企业微信机器人的Webhook地址</small>
                    </div>
                </div>

                <!-- DingTalk Settings -->
                <div class="form-section" id="alert-dingtalk-section" style="display: none;">
                    <h3>钉钉配置</h3>
                    <div class="form-group">
                        <label for="dingtalk-webhook">Webhook URL *</label>
                        <input type="text" id="dingtalk-webhook" placeholder="https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN">
                        <small>钉钉机器人的Webhook地址</small>
                    </div>
                    <div class="form-group">
                        <label for="dingtalk-secret">加签密钥（可选）</label>
                        <input type="text" id="dingtalk-secret" placeholder="SECxxx">
                        <small>钉钉机器人的加签密钥</small>
                    </div>
                </div>

                <!-- Telegram Settings -->
                <div class="form-section" id="alert-telegram-section" style="display: none;">
                    <h3>Telegram配置</h3>
                    <div class="form-group">
                        <label for="telegram-bot-token">Bot Token *</label>
                        <input type="text" id="telegram-bot-token" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                        <small>Telegram Bot的Token</small>
                    </div>
                    <div class="form-group">
                        <label for="telegram-chat-id">Chat ID *</label>
                        <input type="text" id="telegram-chat-id" placeholder="-1001234567890">
                        <small>接收消息的Chat ID（可以是群组或个人）</small>
                    </div>
                </div>

                <!-- Email Settings -->
                <div class="form-section" id="alert-email-section" style="display: none;">
                    <h3>邮件配置</h3>
                    <div class="form-group">
                        <label for="email-smtp-host">SMTP服务器 *</label>
                        <input type="text" id="email-smtp-host" placeholder="smtp.gmail.com">
                    </div>
                    <div class="form-group">
                        <label for="email-smtp-port">SMTP端口 *</label>
                        <input type="number" id="email-smtp-port" placeholder="587" value="587">
                    </div>
                    <div class="form-group">
                        <label for="email-username">用户名 *</label>
                        <input type="text" id="email-username" placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="email-password">密码 *</label>
                        <input type="password" id="email-password" placeholder="your-password">
                        <small>通常是应用专用密码</small>
                    </div>
                    <div class="form-group">
                        <label for="email-from">发件人地址 *</label>
                        <input type="email" id="email-from" placeholder="monitor@example.com">
                    </div>
                    <div class="form-group">
                        <label for="email-to">收件人地址 *</label>
                        <input type="text" id="email-to" placeholder="admin@example.com, ops@example.com">
                        <small>多个地址用逗号分隔</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="email-use-tls" checked>
                            使用TLS
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAlertChannelModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert Rule Modal -->
    <div id="alert-rule-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="alert-rule-modal-title">添加告警规则</h2>
                <button class="close-btn" onclick="closeAlertRuleModal()">&times;</button>
            </div>
            <form id="alert-rule-form" onsubmit="submitAlertRule(event)">
                <input type="hidden" id="alert-rule-id">

                <div class="form-section">
                    <h3>告警规则</h3>
                    <div class="form-group">
                        <label for="alert-rule-target">监控目标 *</label>
                        <select id="alert-rule-target" required>
                            <option value="">请选择监控目标</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alert-rule-channel">告警通道 *</label>
                        <select id="alert-rule-channel" required>
                            <option value="">请选择告警通道</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alert-rule-threshold-type">阈值类型 *</label>
                        <select id="alert-rule-threshold-type" required>
                            <option value="failure_count">故障次数</option>
                            <option value="response_time">响应时间</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alert-rule-threshold-value">阈值 *</label>
                        <input type="number" id="alert-rule-threshold-value" required min="1" value="1">
                        <small>触发告警的阈值（次数或毫秒数）</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="alert-rule-enabled" checked>
                            启用规则
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAlertRuleModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- System Config Modal -->
    <div id="system-config-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>系统配置</h2>
                <button class="close-btn" onclick="closeSystemConfigModal()">&times;</button>
            </div>
            <form id="system-config-form" onsubmit="submitSystemConfig(event)">
                <div class="form-section">
                    <h3>服务器配置</h3>
                    <div class="form-group">
                        <label for="config-host">监听地址</label>
                        <input type="text" id="config-host" required>
                    </div>
                    <div class="form-group">
                        <label for="config-http-port">HTTP 端口</label>
                        <input type="number" id="config-http-port" required min="1" max="65535">
                    </div>
                    <div class="form-group">
                        <label for="config-grpc-port">gRPC 端口</label>
                        <input type="number" id="config-grpc-port" required min="1" max="65535">
                    </div>
                </div>
                <div class="form-section">
                    <h3>数据库配置</h3>
                    <div class="form-group">
                        <label for="config-db-driver">数据库类型</label>
                        <select id="config-db-driver" required onchange="updateDatabaseFields()">
                            <option value="sqlite">SQLite</option>
                            <option value="mysql">MySQL</option>
                            <option value="postgres">PostgreSQL</option>
                        </select>
                    </div>
                    <div id="db-host-group" style="display: none;">
                        <div class="form-group">
                            <label for="config-db-host">数据库主机</label>
                            <input type="text" id="config-db-host">
                        </div>
                    </div>
                    <div id="db-port-group" style="display: none;">
                        <div class="form-group">
                            <label for="config-db-port">端口</label>
                            <input type="number" id="config-db-port" min="1" max="65535">
                        </div>
                    </div>
                    <div id="db-user-group" style="display: none;">
                        <div class="form-group">
                            <label for="config-db-user">用户名</label>
                            <input type="text" id="config-db-user">
                        </div>
                    </div>
                    <div id="db-password-group" style="display: none;">
                        <div class="form-group">
                            <label for="config-db-password">密码</label>
                            <input type="password" id="config-db-password">
                        </div>
                    </div>
                    <div id="db-sslmode-group" style="display: none;">
                        <div class="form-group">
                            <label for="config-db-sslmode">SSL 模式</label>
                            <select id="config-db-sslmode">
                                <option value="disable">禁用</option>
                                <option value="require">要求</option>
                                <option value="verify-ca">验证 CA</option>
                                <option value="verify-full">完全验证</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="config-db-name">数据库名称/文件</label>
                        <input type="text" id="config-db-name" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Elasticsearch 配置</h3>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="config-es-enabled">
                            启用 Elasticsearch
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="config-es-addresses">ES 地址</label>
                        <input type="text" id="config-es-addresses" placeholder="http://localhost:9200">
                    </div>
                    <div class="form-group">
                        <label for="config-es-username">用户名（可选）</label>
                        <input type="text" id="config-es-username">
                    </div>
                    <div class="form-group">
                        <label for="config-es-password">密码（可选）</label>
                        <input type="password" id="config-es-password">
                    </div>
                    <div class="form-group">
                        <label for="config-es-prefix">索引前缀</label>
                        <input type="text" id="config-es-prefix" value="monitor-logs">
                    </div>
                </div>

                <div class="form-section">
                    <h3>监控配置</h3>
                    <div class="form-group">
                        <label for="config-monitor-interval">检查间隔（秒）</label>
                        <input type="number" id="config-monitor-interval" min="10" required>
                    </div>
                    <div class="form-group">
                        <label for="config-monitor-workers">工作线程数</label>
                        <input type="number" id="config-monitor-workers" min="1" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3>日志配置</h3>
                    <div class="form-group">
                        <label for="config-log-level">日志级别</label>
                        <select id="config-log-level" required>
                            <option value="debug">Debug</option>
                            <option value="info">Info</option>
                            <option value="warn">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="config-log-output">输出目标</label>
                        <select id="config-log-output" required>
                            <option value="stdout">标准输出</option>
                            <option value="stderr">标准错误</option>
                            <option value="file">文件</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSystemConfigModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存配置</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/js/utils.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>